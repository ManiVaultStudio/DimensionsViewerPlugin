<!DOCTYPE html>
<html style="padding: 0; margin: 0; width: 100%; height: 100%;">
<head>
    <script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@5"></script>

    <script type="text/javascript" src="qrc:///DimensionsViewer.js"></script>

</head>
	<body style="padding: 0; margin: 0; width: 100%; height: 100%;">
		<div id="view" style="width: 100%; height: 100%; overflow: hidden; "></div>
		<script>

            window.addEventListener("load", function () {

                // Invoked when the dimensions have changed
                var onDimensionsChanged = function (dimensions) {
                    let changeset = vega.changeset().remove(() => true).insert(dimensions);
                    view.change('dimensions', changeset).run();
                }

                // Invoked when the settings have changed
                var onSettingsChanged = function (settings) {
                    view.signal('color0', settings.color0);
                    view.signal('color1', settings.color1);
                    view.signal('color2', settings.color2);
                }

                
                // Create new webchannel and connect to signals from C++
                new QWebChannel(qt.webChannelTransport,
                    function (channel) {
                        channel.objects.configuration.dimensionsChanged.connect(onDimensionsChanged);
                        channel.objects.configuration.settingsChanged.connect(onSettingsChanged);
                    });

                // Vega visualization options
                var options = {
                    //renderer: "canvas",
                    defaultStyle: false
                };

                for (channelIndex = 0; channelIndex < 3; channelIndex++) {
                    addChannel(design, channelIndex);
                }

                // Embed the Vega view
                vegaEmbed('#view', design, options).then(p => {

                    // Find elements with tag name details
                    element = document.getElementsByTagName("details");

                    // And remove them (they corrupt the layout)
                    for (index = 0; index < element.length; index++) {
                        element[index].parentNode.removeChild(element[index]);
                    }

                    // Attached the Vega view to the global window variable so that we can later use it
                    window.view = p.view
                });
            });
		</script>
	</body>
</html>