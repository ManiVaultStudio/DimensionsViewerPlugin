<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@4"></script>
    <!--
    <script type="text/javascript" src="qrc:///Vega5.js"></script>
    <script type="text/javascript" src="qrc:///VegaEmbed5.js"></script>
    <script type="text/javascript" src="qrc:///VegaLite4.js"></script>
        style="background-color:red; width: 300px; height: 300px;"
    -->
    <script type="text/javascript" src="qrc:///DimensionsViewer.js"></script>

</head>
	<body>
		<div id="view"></div>
		<script>
            var onDimensionsChanged = function (dimensions) {
                let changeset = vega.changeset().remove(() => true).insert(JSON.parse(dimensions));
                view.change('dimensions', changeset).run()
			}

			new QWebChannel(qt.webChannelTransport,
				function (channel) {
					var dimensionsViewer = channel.objects.dimensionsViewer;
                    dimensionsViewer.changed.connect(onDimensionsChanged);
				});

            vegaEmbed('#view', design).then(p => window.view = p.view);

            window.onresize = function (event) {
                view.signal('width', event.target.innerWidth - 100)
                    .signal('height', event.target.innerHeight - 100)
                    .run('enter');
            }
		</script>
	</body>
</html>