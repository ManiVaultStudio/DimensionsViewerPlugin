<!DOCTYPE html>
<html style="padding: 0; margin: 0; width: 100%; height: 100%;">
<head>
    <script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@5"></script>
    <script type="text/javascript" src="qrc:///DimensionsViewer.js"></script>

</head>
	<body style="padding: 0; margin: 0; width: 100%; height: 100%;">
		<div id="view" style="width: 100%; height: 100%; overflow: hidden; "></div>
		<script>

            // TODO: Add descripton
            var onChannelChanged = function (channelName, channelData) {
                let changeset = vega.changeset().remove(() => true).insert(channelData);
                view.change('channelName', changeset).run();
                console.log(channelName, channelData)
			}

            // Create new webchannel and connect to signals from C++
			new QWebChannel(qt.webChannelTransport,
				function (channel) {
                    channel.objects.channel1.changed.connect(onChannelChanged);
                    channel.objects.channel2.changed.connect(onChannelChanged);
                    channel.objects.channel3.changed.connect(onChannelChanged);
				});

            // Vega visualization options
            var options = {
                renderer: "canvas",
                defaultStyle: false
            };

            // Embed the Vega view
            vegaEmbed('#view', design, options).then(p => {

                // Find elements with tag name details
                element = document.getElementsByTagName("details");

                // And remove them (they corrupt the layout)
                for (index = 0; index < element.length; index++) {
                    element[index].parentNode.removeChild(element[index]);
                }

                // Attached the Vega view to the global window variable so that we can later use it
                window.view = p.view
            });
		</script>
	</body>
</html>